<script type="text/javascript" src="__PUBLIC__/directSell/area_select.js"></script>
<div class="core_main User" id="edit">
	<div class="core_title"><span class="core_title_con"><span>{:L('当前位置')}：</span>{$nowtitle}</span></div>
	<div class="core_con">
    <form method="post" action="__MODULE__/User/update">
		<table class="tablebg">
        	<tr>
            	<td class="tbkey" >{:L('用户编号')}：</td>
                <td class="tbval" >{$userinfo.编号}</td>
            </tr>
            <if condition="in_array('name',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('姓名')}：</td>
                <td class="tbval" >
                    <if condition="in_array('name',$edit) eq true">
                    <input name="name" type="text" class="reginfo" value="{$userinfo.姓名}"/>
                    <else/>{$userinfo.姓名}</if>
                    <span class="msg"><if condition="in_array('name',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('alias',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('昵称')}：</td>
                <td class="tbval" >
                    <if condition="in_array('alias',$edit) eq true">
                    <input name="alias" type="text" class="reginfo"  value="{$userinfo.昵称}">
                    <else />{$userinfo.昵称}</if>
                    <span class="msg"><if condition="in_array('alias',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <!--<if condition="in_array('phone_auto',$viewarr) eq true  and $theme neq 'wap'">
            <tr>
                <td class="tbkey" >{:L('头像')}：</td>
                <td class="tbval" >
                	<div style="padding:10px 30px;display: inline-block;textalign: center;">
                	<if condition="empty($userinfo['头像']) neq true">
						<img src="{$userinfo['头像']}" alt="face" style="width: 150px;border-radius: 50%;">
						<else />
						<img src="__PUBLIC__/DmsUser/wap_alpha/Public/img/face.png" alt="face">
						</if>
					</div>
                    <a href="__CONTROLLER__/uploadPhoto">上传头像</a>
                </td>
            </tr>
            </if>-->
            <if condition="in_array('sex',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('性别')}：</td>
                <td class="tbval" >
                    <if condition="in_array('sex',$edit) eq true">
                    <select name="sex" id="sex">
                    <option value="男" <eq name="userinfo['性别']" value="男"> selected="true"</eq>>{:L('男')}</option>
                    <option value="女" <eq name="userinfo['性别']" value="女"> selected="true"</eq>>{:L('女')}</option>
                    </select>
                    <else />{$userinfo.性别}</if>
                    <span class="msg"><if condition="in_array('sex',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 1 && $mibao_null eq 0">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题1')}：</span></td>
              <td class="tbval">
                <input type="text" class="reginfo" name="mibao_q1" value="{$mibao_q1}" readonly="readonly" />
              <span class="msg">*</span>
              </TD>
           </TR>

            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案1')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a1" value="{$mibao_a1}" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 2 && $mibao_null eq 0">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题2')}：</span></td>
              <td class="tbval">
                <input type="text" class="reginfo" name="mibao_q2" value="{$mibao_q2}" readonly="readonly"/>
              <span class="msg">*</span>
              </TD>
           </TR>

            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案2')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a2" value="{$mibao_a2}" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 3 && $mibao_null eq 0">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题3')}：</span></td>
              <td class="tbval">
                <input type="text" class="reginfo" name="mibao_q3" value="{$mibao_q3}" readonly="readonly" />
              <span class="msg">*</span>
              </TD>
           </TR>
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案3')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a3" value="{$mibao_a3}" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <!--会员没有密保时-->
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 1 && $mibao_null eq 1">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题1')}：</span></td>
              <td class="tbval">
                <select name="secretsafe_name1" id="dna_ques_1"  class="select_text" style="width:150px;height:20px"  >
                    <option value="-1" selected="selected" >{:L('请选择')}</option>
                    <foreach name="mb" item="mibao">
                        <option value="{$mibao}"  >{$mibao}</option>
                    </foreach>
                </select>
              <span class="msg">*</span>
              </TD>
           </TR>
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案1')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a1" value="" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 2 && $mibao_null eq 1">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题2')}：</span></td>
              <td class="tbval">
                <select name="secretsafe_name2" id="dna_ques_2"  class="select_text" style="width:150px;height:20px">
                    <option value="-1" selected="selected" >{:L('请选择')}</option>
                    <foreach name="mb" item="mibao">
                        <option value="{$mibao}" >{$mibao}</option>
                    </foreach>
                </select>
              <span class="msg">*</span>
              </TD>
           </TR>
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案2')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a2" value="" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <if condition="$reg_safe eq true && $MIBAO_NUM egt 3 && $mibao_null eq 1 ">
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保问题3')}：</span></td>
              <td class="tbval">
                <select name="secretsafe_name3" id="dna_ques_3"  class="select_text" style="width:150px;height:20px" >
                    <option value="-1" selected="selected" >{:L('请选择')}</option>
                    <foreach name="mb" item="mibao">
                        <option value="{$mibao}" >{$mibao}</option>
                    </foreach>
                </select>
              <span class="msg">*</span>
              </TD>
           </TR>
            <TR>
              <td class="tbkey" ><span class="tab_font">{:L('密保答案3')}：</span></td>
              <td class="tbval">
                 <input type="text" class="reginfo" name="mibao_a3" value="" />
              <span class="msg">*</span>
              </TD>
            </TR>
            </if>
            <if condition="in_array('reciver',$show) eq true and adminshow('baodan_wuliu') eq true">
            <tr>
                <td class="tbkey" >{:L('收货人')}：</td>
                <td class="tbval" >
                    <if condition="in_array('reciver',$edit) eq true">
                    <input name="reciver" type="text" class="reginfo"  value="{$userinfo.收货人}">
                    <else />{$userinfo.收货人}</if>
                    <span class="msg"><if condition="in_array('reciver',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('area',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('国家')}：</td>
                <td class="tbval" >
                <if condition="in_array('area',$edit) eq true">
                <select name="country" id="country_id" data-role="none">
                    <option value="">请选择</option>
                </select>
                <else />{$userinfo.国家}</if>
                <span class="msg"><if condition="in_array('area',$require) eq true ">*</if></span></td>
            </tr>
            <tr>
                <td class="tbkey" >{:L('省/州')}：</td>
                <td class="tbval" >
                <if condition="in_array('area',$edit) eq true">
                <select name="province"  id="province_id" data-role="none" >
                    <option value="">请选择</option>
                </select>
                <else />{$userinfo.省份}</if>
                <span class="msg"><if condition="in_array('area',$require) eq true ">*</if></span></td>
            </tr>
            <tr>
                <td class="tbkey" >{:L('城市')}：</td>
                <td class="tbval" >
                <if condition="in_array('area',$edit) eq true" >
                <select name="city" id="city_id" data-role="none" >
                    <option value="">请选择</option>
                </select>
                <else />{$userinfo.城市}</if>
                <span class="msg"><if condition="in_array('area',$require) eq true ">*</if></span></td>
            </tr>
            <tr>
                <td class="tbkey" >{:L('地区')}：</td>
                <td class="tbval" >
                <if condition="in_array('area',$edit) eq true">
                <select name="county" id="county_id" data-role="none" >
                    <option value="">请选择</option>
                </select>
                <else />{$userinfo.地区}</if>
                <span class="msg"><if condition="in_array('area',$require) eq true ">*</if></span></td>
            </tr>
            <tr>
                <td class="tbkey" >{:L('街道')}：</td>
                <td class="tbval" >
                <if condition="in_array('area',$edit) eq true">
                <select name="town" id="town_id" data-role="none" >
                    <option value="">请选择</option>
                </select>
                <else />{$userinfo.街道}</if>
                <span class="msg"><if condition="in_array('area',$require) eq true ">*</if></span></td>
            </tr>
            </if>
            <if condition="in_array('address',$show) eq true">
            <tr>
                <td class="tbkey">{:L('详细地址')}：</td>
                <td class="tbval address">
                <if condition="in_array('address',$edit) eq true">
                <input name="address" type="text" class="reginfo"  size="35" value="{$userinfo.地址}">
                <else />{$userinfo.地址}</if>
                <span class="msg"><if condition="in_array('address',$require) eq true ">*</if></span></td>
            </tr>
            </if>

            <if condition="in_array('id_card',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('证件号码')}：</td>
                <td class="tbval" >
                    <if condition="in_array('id_card',$edit) eq true">
                    <input name="id_card" type="text" class="reginfo" value="{$userinfo.证件号码}">
                    <else />{$userinfo.证件号码}</if>
                    <span class="msg"><if condition="in_array('id_card',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('bank_apply_name',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('开户银行')}：</td>
                <td class="tbval" >
                    <if condition="in_array('bank_apply_name',$edit) eq true">
                    <select name="bank_apply_name" id="bank" style="min-width:200px;width:auto">
                        <option value="">{:L('请选择')}</option>
                        <foreach name="banklist" item="bank">
                        <option <eq name="userinfo.开户银行" value="$bank['开户行']"> selected="true" </eq>>
                        {:L($bank['开户行'])}
                        </option>
                        </foreach>
                    </select>
                    <else />{$userinfo.开户银行}</if>
                    <span class="msg"><if condition="in_array('bank_apply_name',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('bank_card',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('银行卡号')}：</td>
                <td class="tbval" >
                    <if condition="in_array('bank_card',$edit) eq true">
                    <!--
                    <input name="bank_card" type="text"  value="{$userinfo.银行卡号}">
                    -->
                    <input name="bank_card" type="text" class="reginfo" value="{$userinfo.银行卡号}" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                    <else />{$userinfo.银行卡号}</if>
                    <span class="msg"><if condition="in_array('bank_card',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('bank_name',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('开户名')}：</td>
                <td class="tbval" >
                    <if condition="in_array('bank_name',$edit) eq true">
                    <input name="bank_name" type="text" class="reginfo"  value="{$userinfo.开户名}">
                    <else />{$userinfo.开户名}</if>
                    <span class="msg"><if condition="in_array('bank_name',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('bank_apply_addr',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('开户地址')}：</td>
                <td class="tbval" >
                    <if condition="in_array('bank_apply_addr',$edit) eq true">
                    <input name="bank_apply_addr" type="text" class="reginfo"  value="{$userinfo.开户地址}">
                    <else />{$userinfo.开户地址}</if>
                    <span class="msg"><if condition="in_array('bank_apply_addr',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('email',$show) eq true">
            <tr>
                <td class="tbkey" >Email：</td>
                <td class="tbval" >
                    <if condition="in_array('email',$edit) eq true">
                    <input name="email" type="text" class="reginfo" id="email" value="{$userinfo.email}">
                    <else />{$userinfo.email}</if>
                    <span class="msg"><if condition="in_array('email',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('qq',$show) eq true">
            <tr>
                <td class="tbkey" >QQ：</td>
                <td class="tbval" >
                    <if condition="in_array('qq',$edit) eq true">
                    <!--
                    <input name="qq" type="text"  value="{$userinfo.qq}">
                    -->
                    <input name="qq" type="text" class="reginfo" value="{$userinfo.qq}" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                    <else />{$userinfo.qq}</if>
                    <span class="msg"><if condition="in_array('qq',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <!--定制**修改钱包地址-->
            <tr>
                <td class="tbkey" >{:L('钱包地址')}：</td>
                <td class="tbval" >
                    <input name="bank_address" type="text" style="width:300px" class="reginfo" value="{$userinfo.钱包地址}" />
                </td>
            </tr>
            <if condition="in_array('weixin',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('微信号')}：</td>
                <td class="tbval" >
                    <if condition="in_array('weixin',$edit) eq true">
                    <input name="weixin" type="text" class="reginfo"  value="{$userinfo.微信账号}">
                    <else />{$userinfo.微信账号}</if>
                    <span class="msg"><if condition="in_array('weixin',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('alipay',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('支付宝')}：</td>
                <td class="tbval" >
                    <if condition="in_array('alipay',$edit) eq true">
                    <input name="alipay" type="text" class="reginfo"  value="{$userinfo.支付宝}">
                    <else />{$userinfo.支付宝}</if>
                    <span class="msg"><if condition="in_array('alipay',$require) eq true ">*</if></span>
                </td>
            </tr>
            </if>
            <if condition="in_array('country_code',$show) eq true ">
			<tr>
			<td class="tbkey" >
			<if condition="in_array('country_code',$require) eq true ">*</if>{:L('国家代码')}：</td>
			<td style="border-right:none;text-align:left">
			     <select name='country_code' id="country_code" style="width: 152px;height: 21px">
			     	<foreach name='NumCheck' item='data' key='code'>
			     		<option value="{$code}" data-pattern="{$data.exp}" <eq name="userinfo['国家代码']" value="$code">selected</eq>>{$data.zh-cn}</option>
			     	</foreach>
			     </select>
			</td>
			</tr>
			</if>
            <if condition="in_array('mobile',$show) eq true">
            <tr>
                <td class="tbkey" >{:L('移动电话')}：</td>
                <td class="tbval" >
                <if condition="in_array('mobile',$edit) eq true">
                <input id="mobile" name="mobile" type="text" class="reginfo" value="{$userinfo.移动电话}" onKeyup="getinfo(this)" maxlength="11" >
                <else />{$userinfo.移动电话}</if>
                <span id="state_mobile" class="msg"><if condition="in_array('mobile',$require) eq true ">*</if></span></td>
            </tr>
            </if>
            <if condition="adminshow('phone_login') && CONFIG('verifiregmobliesmsSwitch') eq 1 && CONFIG('verifiregmobliesmsContent') neq ''">
                <tr id="msgsend" style="display:none">
                    <td class="tbkey">{:L('短信验证码')}：</td>
                    <td class="tbval">
                        <span><input name="regMobileSmsVerfy" type="text" class="reginfo" id="regMobileSmsVerfy" /></span>
                        <if condition="isset($smsif_arr['text'])">
                            <span><input style="margin-left:10px" type="button" id="sendMess" class="send-msg" value="{:L('获取短信')}" /></span>
                        </if>
                        <if condition="isset($smsif_arr['audio'])">
                            <span><input style="margin-left:10px" type="button" id="sendAudio" class="send-msg" value="{:L('获取语音')}" /></span>&nbsp;&nbsp;
                        </if>
                        <span class="msg" id="state_regMobileSmsVerfy"></span></td>
                    </td>
                </tr>
            </if>
            <tr >
                <td colspan="2">
                    <button class="button_text button-150" type="submit">{:L('确定')}</button>
                </td>
            </tr>
		</table>
	</form>
    </div>
</div>
<script>
$.area_default_show=true;
$.area_default_country="{$userinfo['国家']}";
$.area_default_province="{$userinfo['省份']}";
$.area_default_city="{$userinfo['城市']}";
$.area_default_county="{$userinfo['地区']}";
$.area_default_town="{$userinfo['街道']}";
$.area_select_bind( 'country_id' , 'province_id' , 'city_id' , 'county_id', 'town_id' );
</script>

<!-- 短信验证码 -->
<if condition="adminshow('smsSwitch') && CONFIG('verifiregmobliesmsSwitch') eq 1 && CONFIG('verifiregmobliesmsContent') neq ''">
<script src="__PUBLIC__/js/sendsms.js"></script>
<script src="__PUBLIC__/layer/layer.js"></script>
<script>
var	characters	= {title:"{:L('提示')}",determ:"{:L('确定')}",clickget:"{:L('点击获取')}",resend:"{:L('重新发送')}"};
var type		= '注册手机号验证真实性';
var mobile      = '*****';
var isaudio     = 0;
var smsObj;

$(".send-msg").click(function(){
	if($("#mobile").length > 0){
		mobile = $("#mobile").val();
		var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
		if(mobile == '' || !myreg.test(mobile)){
			$("#state_mobile").html('请先正确填写手机号码');
			document.form1.mobile.focus()
			return false;
		}else{
			$("#state_mobile").html('*');
		}
	}
	if($(this).attr("id") == "sendMess"){
		smsObj = $("#sendMess");
	}else{
		smsObj = $("#sendAudio");
	}
	if("{$picVerify}" === "false"){
		time(smsObj);
	}else{
    layer.open({
        type: 1,
        title:'{:L("填写验证码")}',
        skin: 'layui-layer-rim', //加上边框
        area: ['300px', '200px'], //宽高
        btn: ['{:L("确定")}'],
        yes: function(index, layero){
          //点击按钮之后，直接触发AJAX..
          var postval = $("#verifyss").val();
          if(postval == ''){
          	postval = '***';
          }
          $.ajax({
            url:"__CONTROLLER__/verify_s/id/"+postval,
            type:"GET",
            dataType:"JSON",
            data:postval,
            success:function(data){
                if( data.status == 0 )
                {
                    $('#msg').html(data.tip);
                    var timenow = new Date().getTime();
                    $('#qqsmsverifyImg').attr('src', '__CONTROLLER__/verifyImg/adv/1/' + timenow);
                }
                else
                {
                    layer.close(index);     //关闭弹出层
                    time(smsObj);
                }
            }
            });
        },
        content: '<div style="margin:10px 75px 0 75px;"><input id="verifyss" maxlength="4" type="text" name="verifyss" value="">'+'<img id="qqsmsverifyImg" src="__CONTROLLER__/verifyImg" onClick="smsfreshVerify(this)" border="0" alt="点击刷新验证码" ><span id="msg" style="color:red"></span></div>',
    });
    }
});
function smsfreshVerify() {
    //重载验证
    var timenow = new Date().getTime();
    if (type) {
        $('#qqsmsverifyImg').attr('src', '__CONTROLLER__/verifyImg/adv/1/' + timenow);
    } else {
        $('#qqsmsverifyImg').attr('src', '__CONTROLLER__/verifyImg/' + timenow);
    }
}
</script>
</if>
<!-- 短信验证码 -->

<script>
function getinfo(e){
	var vd;
	e.value=e.value.replace(/\D/g,'');
	<if condition="adminshow('smsSwitch') && CONFIG('verifiregmobliesmsSwitch') eq 1 && CONFIG('verifiregmobliesmsContent') neq ''">
	if(e.value.length < 11){
		$("#state_mobile").html('<font color="red">{:L("请输入正确手机号码")}</font>');
	}else{
		$("#state_mobile").html('<font color="red">*</font>');
		clearTimeout(vd);
		vd = setTimeout("editAjax()",100);
	}
	</if>
}

function editAjax()
{
	var mobile = $('#mobile').val();
	$.ajax({
	       	url:"__APP__/DmsUser/User/editAjax",
	       	type:"POST",
	       	data:{mobile:mobile},
	       	dataType:"json",
	       	success:function(data){
			   	if(data.data == "1"){
				  	$("#msgsend").css("display","");
			   	}else{
				  	$("#msgsend").css("display","none");
			   	}
	       	}
	    });
}
</script>
<script>
    var mibao_option = $("#dna_ques_1").html();

    $(".select_text").change(function(){
        var name = this.name;
            // 初始化除自身外的其他select
            $(".select_text").each(function(){
                if(this.name == name){
                    return true;
                }
                var selected = this.value;
                $(this).empty(); // 清空
                $(this).prepend(mibao_option); // 初始化
                $("#"+this.id+" option[value="+selected+"]").attr('selected','selected');
            });

        $(".select_text").each(function(){
            var value = this.value;
            var name = this.name;
            if(value == '-1'){ // 过滤初始值
                return true;
            }
            // 当前节点已选定的从其他节点删除掉
            $(".select_text").each(function(){
                if(this.name == name){ // 过滤自身
                    return true;
                }
                $("#"+this.id+" option[value="+value+"]").remove(); //删除
            });
        });

    });
</script>
